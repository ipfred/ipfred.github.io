# 多平台GitHub配置代理

**本地拉取github老是失败，可通过全局配置代理，或只给github.com配置代理**



&gt; 前言：本地拉取github老是失败，可通过全局配置代理，或只给github.com配置代理

# git 配置代理

## windows 设置代理

### http || https协议

```bash
//设置全局代理
git config --global https.proxy http://127.0.0.1:7897
git config --global https.proxy https://127.0.0.1:7897
// socks
git config --global http.proxy socks5://127.0.0.1:7897
git config --global https.proxy socks5://127.0.0.1:7897
//只对github.com使用代理，其他仓库不走代理
git config --global http.https://github.com.proxy socks5://127.0.0.1:7897
git config --global https.https://github.com.proxy socks5://127.0.0.1:7897
//取消github代理
git config --global --unset http.https://github.com.proxy
git config --global --unset https.https://github.com.proxy
//取消全局代理
git config --global --unset http.proxy
git config --global --unset https.proxy
```

### SSH协议

```bash
//对于使用git@协议的，可以配置socks5代理
//在~/.ssh/config 文件后面添加几行，没有可以新建一个
//socks5
Host github.com
User git
ProxyCommand connect -S 127.0.0.1:7897 %h %p
//http || https
Host github.com
User git
ProxyCommand connect -H 127.0.0.1:7897 %h %p
```

## WSL2设置代理

在 Ubuntu 子系统中，通过 **cat /etc/resolv.conf** 查看 DNS 服务器 IP

```bash
cat /etc/resolv.conf
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 172.23.64.1
```

其实上面地址就是windows下面这个ip地址

**win11-&gt;设置-&gt;网络和Internet-&gt;高级网络设置-&gt;硬件和连接属性**

名称：vEthernet (WSL)

ipv4地址：172.23.64.1/20

我们要为WSL配置ssh代理和http代理

```bash
touch ~/.ssh/config
vim ~/.ssh/config
Host github.com
    HostName github.com
    User git
    # 走 socks5 代理
    ProxyCommand nc -v -x 172.28.32.1:7897 %h %p
```

使用下面命令检查ssh代理配置是否成功

```bash
ssh -T github.com
Connection to github.com 22 port [tcp/ssh] succeeded!
Hi wq-zhijun! You&#39;ve successfully authenticated, but GitHub does not provide shell access.
```

可以将上面ip地址配置代理写入到.bashrc文件中，这样就可以自己用户开机永久生效，

**另外apt要单独在/etc/apt/apt.conf设置代理**

```bash
export u_host=`cat /etc/resolv.conf|grep nameserver|awk &#39;{print $2}&#39;`
sed -i &#34;/.*ProxyCommand*/c\     ProxyCommand nc -v -x $u_host:7897 %h %p&#34; ~/.ssh/config
proxy () {
    export ALL_PROXY=&#34;http://$u_host:7897&#34;
    export all_proxy=&#34;http://$u_host:7897&#34;
    export {http,https,ftp}_proxy=$ALL_PROXY
    export {HTTP,HTTPS,FTP}_PROXY=$ALL_PROXY
    echo -e &#34;Acquire::http::Proxy \&#34;http://$u_host:7897\&#34;;&#34; | sudo tee -a /etc/apt/apt.conf &gt; /dev/null
    echo -e &#34;Acquire::https::Proxy \&#34;http://$u_host:7897\&#34;;&#34; | sudo tee -a /etc/apt/apt.conf &gt; /dev/null
    curl ip.gs
}
proxy # default call
proxy noproxy () {
    unset ALL_PROXY
    unset all_proxy
    sudo sed -i -e &#39;/Acquire::http::Proxy/d&#39; /etc/apt/apt.conf
    sudo sed -i -e &#39;/Acquire::https::Proxy/d&#39; /etc/apt/apt.conf
    curl ip.gs
}
```

**7897端口** 是clash for windows端口，另外将 **Allow LAN** 打开。

还需要将防火墙打开

win&#43;r 输入 control到如下目录

**控制面板\\系统和安全\\Windows Defender 防火墙**

放行clash*

## git push失败或者卡住不动问题

原因是有的节点22端口被服务端封锁了，要么改服务端端口要么改自己本地更换443端口（~/.ssh/config)

```bash
# 可以先使用如下测试下
ssh -T -p 443 git@ssh.github.com
# Hi USERNAME! You&#39;ve successfully authenticated, but GitHub does not provide shell access.
# 更换端口后再测试下
ssh -T git@github.com
# Hi USERNAME! You&#39;ve successfully authenticated, but GitHub does not provide shell access.
# .ssh目录的config文件添加如下内容
vim ~/.ssh/config
Host github.com
    HostName github.com
    User git
    # set socks5 proxy
    ProxyCommand nc -v -x 172.23.64.1:7897 %h %p
```

## 修改配置文件的方式
- windows系统的配置 文件在 `C:\Users\admin\.gitconfig`
配置文件如下

```ini
[http &#34;https://github.com&#34;]
	proxy = http://127.0.0.1:7897
[https &#34;https://github.com&#34;]
	proxy = https://127.0.0.1:7897
```

---

> 作者: [Fred](https://github.com/ipfred)  
> URL: https://ipfred.github.io/lang/git/20250425152252/  

